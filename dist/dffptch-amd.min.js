define(function(){var r={},e=Object,t=e.keys;return r.diff=function f(r,n){for(var o=t(r).sort(),a=t(n).sort(),i={},d={},s={},c=[],u={},v=0,h=0;o[v]||a[h];){var l=o[v],m=String.fromCharCode(v+32),C=a[h],p=r[l],b=n[C];if(l==C){if(e(p)===p&&e(b)===b){var g=f(p,b);t(g)&&(u[m]=g)}else p!==b&&(s[m]=b);v++,h++}else l>C||!l?(d[C]=b,h++):(c.push(m),v++)}return c[0]&&(i.d=c),t(d)[0]&&(i.a=d),t(s)[0]&&(i.m=s),t(u)[0]&&(i.r=u),i},r.patch=function n(r,e){var f,o,a,i,d=t(r).sort();for(f in e)for(o in e[f])a=e[f][o],i=d[("d"!=f?o:a).charCodeAt()-32],"a"==f?r[o]=a:"m"==f?r[i]=a:"d"==f?delete r[i]:n(r[i],a)},r});